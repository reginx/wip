System.register([],(function(t,e){"use strict";var i=document.createElement("style");return i.textContent=".wip{position:relative;background-color:#252525}.wip canvas.wip-video{background-color:transparent}.wip canvas.wip-status{position:absolute;left:0;right:0;bottom:0;background-color:transparent}.wip span.wip-title{position:absolute;right:10px;top:10px;font-size:12px;color:#ccc}.wip a.wip-btn-max{position:absolute;right:10px;bottom:10px;font-size:12px;color:#ccc;cursor:pointer}.wip a.wip-btn-max:hover{color:#fff}.wip:hover .wip-btn{opacity:1}.wip .wip-btn{position:absolute;left:0;top:0;right:0;bottom:0;margin:auto;border:0;background:transparent;box-sizing:border-box;width:0;height:74px;opacity:0;border-color:transparent transparent transparent #202020;transition:.1s all ease;cursor:pointer;border-style:double;border-width:0px 0 0px 60px}.wip .wip-btn.paused{border-style:solid;border-width:37px 0 37px 60px;opacity:1}.wip .wip-btn:hover{border-color:transparent transparent transparent #e7e7e7}\n",document.head.appendChild(i),{execute:function(){const t=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],e=(()=>{if("undefined"==typeof document)return!1;const e=t[0],i={};for(const s of t)if((null==s?void 0:s[1])in document){for(const[t,n]of s.entries())i[e[t]]=n;return i}return!1})(),i={change:e.fullscreenchange,error:e.fullscreenerror};let s={request:(t=document.documentElement,i)=>new Promise(((n,a)=>{const h=()=>{s.off("change",h),n()};s.on("change",h);const l=t[e.requestFullscreen](i);l instanceof Promise&&l.then(h).catch(a)})),exit:()=>new Promise(((t,i)=>{if(!s.isFullscreen)return void t();const n=()=>{s.off("change",n),t()};s.on("change",n);const a=document[e.exitFullscreen]();a instanceof Promise&&a.then(n).catch(i)})),toggle:(t,e)=>s.isFullscreen?s.exit():s.request(t,e),onchange(t){s.on("change",t)},onerror(t){s.on("error",t)},on(t,e){const s=i[t];s&&document.addEventListener(s,e,!1)},off(t,e){const s=i[t];s&&document.removeEventListener(s,e,!1)},raw:e};Object.defineProperties(s,{isFullscreen:{get:()=>Boolean(document[e.fullscreenElement])},element:{enumerable:!0,get:()=>{var t;return null!==(t=document[e.fullscreenElement])&&void 0!==t?t:void 0}},isEnabled:{enumerable:!0,get:()=>Boolean(document[e.fullscreenEnabled])}}),e||(s={isEnabled:!1});const n=s;window.WsImagePlayer=class{decimalMul(t,e){var i=0,s=t.toString(),n=e.toString();try{i+=s.split(".")[1].length}catch(a){}try{i+=n.split(".")[1].length}catch(a){}return Number(s.replace(".",""))*Number(n.replace(".",""))/Math.pow(10,i)}decimalDiv(t,e){var i,s=0,n=0,a=t.toString(),h=e.toString();try{void 0!==a.split(".")[1]&&(s=a.split(".")[1].length)}catch(l){}try{void 0!==h.split(".")[1]&&(n=h.split(".")[1].length)}catch(l){}return i=Math.pow(10,Math.max(s,n)),this.decimalMul(t,i)/this.decimalMul(e,i)}createHDCanvas(t,e){var i;let s=document.createElement("canvas");return s.width=t*this.pixelRatio,s.height=e*this.pixelRatio,s.style.width=`${t}px`,s.style.height=`${e}px`,null===(i=s.getContext("2d"))||void 0===i||i.setTransform(this.pixelRatio,0,0,this.pixelRatio,0,0),s}adapterLayout(){var t,e;this.width=this.el.offsetWidth,this.height=this.el.offsetHeight,this.canvas.width=this.width*this.pixelRatio,this.canvas.height=this.height*this.pixelRatio,this.canvas.style.width=`${this.width}px`,this.canvas.style.height=`${this.height}px`,null===(t=this.canvas.getContext("2d"))||void 0===t||t.setTransform(this.pixelRatio,0,0,this.pixelRatio,0,0),this.videoWidth=this.width,this.videoHeight=parseInt(String(this.decimalDiv(this.imageHeight,this.decimalDiv(this.imageWidth,this.width)))),this.videoTop=parseInt(String(this.decimalDiv(this.height-this.videoHeight,2)));let i=this.width/3,s=Math.max(this.videoTop,30);this.statusCanvas.width=i*this.pixelRatio,this.statusCanvas.height=s*this.pixelRatio,this.statusCanvas.style.width=`${i}px`,this.statusCanvas.style.height=`${s}px`,null===(e=this.statusCanvas.getContext("2d"))||void 0===e||e.setTransform(this.pixelRatio,0,0,this.pixelRatio,0,0),this.statusCtx.fillStyle="#fff",this.statusFontSize=Math.max(this.statusCanvas.width/55,10)}constructor(t,e,i){if(this.title=i||"",this.pixelRatio=window.devicePixelRatio||1,this.el=t,!this.el.offsetWidth)throw new Error("el 宽度不能为 0");this.wsUrl=e,this.wsRecvAt=0,this.width=this.el.offsetWidth,this.height=this.el.offsetHeight,this.el.className=this.el.className+" wip",this.el.childNodes.forEach((t=>{var e;null===(e=this.el)||void 0===e||e.removeChild(t)})),this.canvas=null,this.ctx=null,this.statusCanvas=null,this.status=null,this.btn=null,this.btnMax=null,this.canvas=this.createHDCanvas(this.width,this.height),this.canvas.className="wip-video",this.el.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.btn=document.createElement("button"),this.btn.className="wip-btn",this.btn.onclick=()=>{var t;this.ws&&(null!==(t=this.btn)&&void 0!==t&&t.className.includes("paused")?(this.btn.className=this.btn.className.replace(" paused",""),this.videoCanPlay=!0):(this.btn.className=this.btn.className+" paused",this.videoCanPlay=!1))},this.el.appendChild(this.btn),this.titleSpan=document.createElement("span"),this.titleSpan.className="wip-title",this.titleSpan.innerText=this.ws?this.title:"loading",this.el.appendChild(this.titleSpan),this.btnMax=document.createElement("a"),this.btnMax.className="wip-btn-max",this.btnMax.innerText="全屏",this.btnMax.onclick=()=>{this.fullscreen()},this.el.appendChild(this.btnMax),this.videoCanPlay=!0}initStatus(){this.statusCanvas=this.createHDCanvas(this.width/3,Math.max(this.videoTop,30)),this.statusCanvas.className="wip-status",this.el.appendChild(this.statusCanvas),this.statusCtx=this.statusCanvas.getContext("2d"),this.statusCtx.fillStyle="#fff",this.statusFontSize=Math.max(this.statusCanvas.width/55,10)}test(){for(let t=0;t<300;t++)new WebSocket(this.wsUrl)}start(){this.ws||(this.ws=new WebSocket(this.wsUrl),this.ws.onopen=()=>{this.wsStartAt=Math.round(Number(new Date)/1e3),this.titleSpan.innerText=this.title},this.ws.onmessage=t=>{let e=Math.round(Number(new Date)/1e3);if(this.videoCanPlay){let e=new Image;e.src=window.URL.createObjectURL(t.data),e.onload=()=>{this.videoWidth||(this.imageWidth=e.naturalWidth,this.imageHeight=e.naturalHeight,this.videoWidth=this.width,this.videoHeight=parseInt(String(this.decimalDiv(this.imageHeight,this.decimalDiv(this.imageWidth,this.width)))),this.videoTop=parseInt(String(this.decimalDiv(this.height-this.videoHeight,2))),this.initStatus()),e.setAttribute("width",this.videoWidth*this.pixelRatio+"px"),e.setAttribute("height",this.videoHeight*this.pixelRatio+"px"),this.ctx.drawImage(e,0,this.videoTop>0?this.videoTop:0,this.videoWidth,this.videoHeight)}}if(this.wsRecvAt>0&&e-this.wsRecvAt>=1&&this.statusCanvas){let t="",e=this.wsRecvAt-this.wsStartAt,i=e/3600>=1?parseInt(String(e/3600)):0;t=String(i<10?"0"+i:i)+":",e%=3600;let s=e/60>=1?parseInt(String(e/60)):0;t=t+String(s<10?"0"+s:s)+":",e%=60,t+=e<10?"0"+e:e,this.statusCtx.clearRect(0,0,this.statusCanvas.offsetWidth,this.statusCanvas.offsetHeight),this.statusCtx.font=this.statusFontSize+"px sans-serif",this.statusCtx.fillText(t,10*this.pixelRatio,this.videoTop-10,80*this.pixelRatio)}this.wsRecvAt=e},this.ws.onclose=t=>{this.ws=null,this.titleSpan.innerText="loading"},this.ws.onerror=t=>{this.ws=null,this.titleSpan.innerText="loading",setTimeout((()=>{this.start()}),3e3)})}stop(){this.ws&&(this.ws.close(),this.ws=null)}fullscreen(){n.isEnabled&&(n.on("change",(()=>{this.btnMax.innerText=n.isFullscreen?"退出":"全屏",this.adapterLayout()})),n.isFullscreen?n.exit():n.request(this.el))}}}}}));
